<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Focus Articles</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; display: grid; grid-template-columns: 75% auto; gap: 20px; }
  #content { grid-column: 1; }
  #toc { grid-column: 2; position: sticky; top: 20px; padding: 15px; border-left: 1px solid #ddd; max-height: 80vh; overflow-y: auto; }
  #toc h3 { margin-top: 0; }
  #toc ul { list-style: none; padding: 0; }
  #toc li { margin-bottom: 5px; }
  #toc .country-link { margin-left: 15px; }
  h1 { margin-top: 40px; }
  .country { margin-left: 20px; }
  .article { margin-left: 40px; padding: 15px; border: 1px solid #ddd; margin-bottom: 20px; }
  .images-container { overflow-x: auto; white-space: nowrap; max-width: 100%; }
  img { max-width: 300px; display: inline-block; margin: 5px; vertical-align: top; }
</style>
</head>
<body>
<h1>Articoli estratti (Focus Mode)</h1>
<div id="content"></div>
<div id="toc">
  <h3>Navigazione</h3>
  <ul></ul>
</div>
<script>
async function loadData() {
  const res = await fetch("/api/focusT.js");
  const json = await res.json();
  const container = document.getElementById("content");
  const tocList = document.querySelector("#toc ul");
  const data = json.results;
  
  for (const continent of Object.keys(data)) {
    const continentId = continent.toLowerCase().replace(/\s+/g, '-');
    const h = document.createElement("h1");
    h.textContent = continent;
    h.id = continentId;
    container.appendChild(h);
    
    // Aggiungi link al TOC per il continente
    const continentLi = document.createElement("li");
    continentLi.innerHTML = `<a href="#${continentId}">${continent}</a>`;
    tocList.appendChild(continentLi);
    
    const countries = data[continent];
    for (const country of Object.keys(countries)) {
      const countryId = `${continentId}-${country.toLowerCase().replace(/\s+/g, '-')}`;
      const h2 = document.createElement("h2");
      h2.textContent = "ðŸ‡ºðŸ‡³ " + country;
      h2.id = countryId;
      h2.className = "country";
      container.appendChild(h2);
      
      // Aggiungi link al TOC per il paese (indentato)
      const countryLi = document.createElement("li");
      countryLi.className = "country-link";
      countryLi.innerHTML = `<a href="#${countryId}">ðŸ‡ºðŸ‡³ ${country}</a>`;
      tocList.appendChild(countryLi);
      
      const articles = countries[country];
      for (const art of articles) {
        const div = document.createElement("div");
        div.className = "article";
        if (art.error) {
          div.innerHTML = `<strong>Errore:</strong> ${art.error}`;
        } else {
          div.innerHTML = `
            <h3><a href="${art.url}" target="_blank">${art.url}</a></h3>
            <p>${art.translated_text_it?.replace(/\n/g, "<br>")}</p>
            <div class="images-container">
              ${(art.images || [])
                .map(src => `<img src="${src}" alt="image">`)
                .join("")}
            </div>
          `;
        }
        container.appendChild(div);
      }
    }
  }
}
loadData();
</script>
</body>
</html>